---
description: "React/TypeScript frontend development patterns and conventions"
globs: ["packages/ui/**/*.{ts,tsx,css}"]
---

# UI Package Development

## Technology Stack

- **React 19** with TypeScript
- **Vite** for build tooling
- **TanStack Router** for file-based routing
- **TanStack Query** for server state management
- **Tailwind CSS** for styling
- **shadcn/ui** for accessible UI components
- **Vitest** + React Testing Library for testing
- **Storybook** for component development

## Project Structure

```
packages/ui/
├── src/
│   ├── components/      # UI components (atoms, molecules, organisms)
│   ├── routes/          # TanStack Router file-based routes
│   ├── hooks/           # Custom React hooks (TanStack Query wrappers)
│   ├── services/        # API client functions
│   ├── schemas/         # Zod schemas for API responses
│   ├── styles/          # Global CSS and Tailwind config
│   └── test/            # Test utilities and setup
├── .storybook/          # Storybook configuration
└── vitest.config.ts     # Test configuration
```

## File-Based Routing

TanStack Router uses the file system for route definitions:

```typescript
// src/routes/about.tsx -> /about
import { createFileRoute } from '@tanstack/react-router';

export const Route = createFileRoute('/about')({
  component: About,
});

function About() {
  return <div>About page</div>;
}
```

### Route Patterns

| File | Route |
|------|-------|
| `routes/index.tsx` | `/` |
| `routes/about.tsx` | `/about` |
| `routes/users/$id.tsx` | `/users/:id` (dynamic) |
| `routes/settings/index.tsx` | `/settings` |
| `routes/__root.tsx` | Root layout wrapper |

The route tree (`routeTree.gen.ts`) regenerates automatically during development.

## Component Patterns

### Atomic Design

Organize components by complexity:

```
components/
├── atoms/           # Basic building blocks (Button, Input, Badge)
├── molecules/       # Combinations of atoms (FormField, Card)
├── organisms/       # Complex components (Header, Footer, DataTable)
└── templates/       # Page layouts (DashboardLayout)
```

### Component Structure

Each component should have:
- `component-name.tsx` - Component implementation
- `component-name.stories.tsx` - Storybook stories
- `component-name.test.tsx` - Tests (co-located)

```typescript
// components/atoms/button/button.tsx
import { cn } from '@/lib/utils';

interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'default' | 'outline' | 'ghost';
}

export function Button({ variant = 'default', className, ...props }: ButtonProps) {
  return (
    <button
      className={cn(
        'px-4 py-2 rounded-md font-medium',
        variant === 'default' && 'bg-primary text-white',
        variant === 'outline' && 'border border-primary',
        className
      )}
      {...props}
    />
  );
}
```

## API Integration Pattern

Use the hooks/services pattern for API calls:

```
Component → Hook → TanStack Query → Service → API
```

### 1. Define Schema (Zod)

```typescript
// schemas/user.ts
import { z } from 'zod';

export const userSchema = z.object({
  id: z.number(),
  name: z.string(),
  email: z.string().email(),
});

export type User = z.infer<typeof userSchema>;
```

### 2. Create Service

```typescript
// services/users.ts
import { userSchema, type User } from '@/schemas/user';

const API_URL = import.meta.env.VITE_API_BASE_URL;

export async function fetchUsers(): Promise<User[]> {
  const response = await fetch(`${API_URL}/users`);
  if (!response.ok) throw new Error('Failed to fetch users');
  const data = await response.json();
  return z.array(userSchema).parse(data);
}
```

### 3. Create Hook

```typescript
// hooks/users.ts
import { useQuery } from '@tanstack/react-query';
import { fetchUsers } from '@/services/users';

export function useUsers() {
  return useQuery({
    queryKey: ['users'],
    queryFn: fetchUsers,
  });
}
```

### 4. Use in Component

```typescript
// components/user-list.tsx
import { useUsers } from '@/hooks/users';

export function UserList() {
  const { data: users, isLoading, error } = useUsers();

  if (isLoading) return <div>Loading...</div>;
  if (error) return <div>Error loading users</div>;

  return (
    <ul>
      {users?.map(user => <li key={user.id}>{user.name}</li>)}
    </ul>
  );
}
```

## Commands

```bash
# Development
pnpm --filter ui dev          # Start dev server
pnpm --filter ui build        # Production build

# Testing
pnpm --filter ui test         # Run tests (watch mode)
pnpm --filter ui test:run     # Run tests once

# Storybook
pnpm --filter ui storybook    # Start Storybook

# Code quality
pnpm --filter ui lint         # ESLint
pnpm --filter ui format       # Prettier
pnpm --filter ui type-check   # TypeScript
```

## Styling Guidelines

- Use Tailwind CSS utility classes
- Use `cn()` helper for conditional classes
- Prefer shadcn/ui components for accessibility
- Define design tokens in `tailwind.config.js`
